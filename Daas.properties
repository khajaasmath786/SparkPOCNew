Name=khajaasmath
LastName=Mohammed
DB.SQLServer.URL=jdbc:sqlserver://66.111.148.20
DB.SQLServer.Driver=com.microsoft.sqlserver.jdbc.SQLServerDriver
DB.SQLServer.UserName=abac
DB.SQLServer.Password=Mcd@abac
DB.SQLServer.Database=ABaCPROD.dbo
Master=local[*]
Driver.Memory=1g
Executor.Memory=1g
Cassandra.Host=127.0.0.1
SMTP.Host=10.133.4.20
SMTP.Port=25
FromEmailAddress=DAASApplication@donotreply.us.mcd.com
ToEmailAddress=khajaasmath.mohammed@us.mcd.com
CCEmailAddress=khajaasmath.mohammed@us.mcd.com
BCCEmailAddress=khajaasmath.mohammed@us.mcd.com
DLY_DYPT_POS_TRN_NP_POPULATE=insert overwrite table daastest.DLY_DYPT_POS_TRN_NP select agg.TERR_CD, agg.POS_BUSN_DT, agg.MCD_GBAL_LCAT_ID_NU, agg.POS_AREA_TYP_SHRT_DS, agg.POS_PRD_DLVR_METH_CD, agg.DYPT_ID_NU, dypt.dypt_ds as DYPT_DS, cldt.dy_of_cal_wk_ds as DY_OF_CAL_WK_DS, agg.LGCY_LCL_RFR_DEF_CD, agg.DIGL_OFFR_TRN_CNT_QT, agg.DIGL_OFFR_TRN_ITM_CNT_QT, agg.DIGL_OFFR_TRN_NET_SLS_AM, agg.DIGL_OFFR_TRN_GRSS_SLS_AM, agg.NON_DIGL_OFFR_TRN_CNT_QT, agg.NON_DIGL_OFFR_TRN_ITM_QT, agg.NON_DIGL_OFFR_TRN_NET_SLS_AM, agg.NON_DIGL_OFFR_TRN_GRSS_SLS_AM, agg.TOT_TRN_CNT_QT, agg.TOT_TRN_ITM_CNT_QT, agg.TOT_TRN_NET_SLS_AM, agg.TOT_TRN_GRSS_SLS_AM, agg.DIGL_OFFR_TOT_ORD_SC_QT, agg.NON_DIGL_OFFR_TOT_ORD_SC_QT, agg.TOT_TOT_ORD_TM_SC_QT, agg.TERR_CD as CURN_ISO_NU, 0 as non_digl_offr_prmo_cnt_qt, 0 as digl_offr_net_prmo_am, 0 as digl_offr_net_disc_am, 0 as digl_offr_puch_trn_cnt_qt from (select  coalesce(a.TERR_CD,a.TERR_CD,b.TERR_CD) as TERR_CD, coalesce(a.POS_BUSN_DT,a.POS_BUSN_DT,b.POS_BUSN_DT) as POS_BUSN_DT, coalesce(a.MCD_GBAL_LCAT_ID_NU,a.MCD_GBAL_LCAT_ID_NU,b.MCD_GBAL_LCAT_ID_NU) as MCD_GBAL_LCAT_ID_NU, coalesce(a.POS_AREA_TYP_SHRT_DS,a.POS_AREA_TYP_SHRT_DS,b.POS_AREA_TYP_SHRT_DS) as POS_AREA_TYP_SHRT_DS, coalesce(a.POS_PRD_DLVR_METH_CD,a.POS_PRD_DLVR_METH_CD,b.POS_PRD_DLVR_METH_CD) as POS_PRD_DLVR_METH_CD, coalesce(a.DYPT_ID_NU,a.DYPT_ID_NU,b.DYPT_ID_NU) as DYPT_ID_NU, coalesce(a.LGCY_LCL_RFR_DEF_CD,a.LGCY_LCL_RFR_DEF_CD,b.LGCY_LCL_RFR_DEF_CD) as LGCY_LCL_RFR_DEF_CD, coalesce(b.CNT_POS_ORD_KEY_ID,b.CNT_POS_ORD_KEY_ID,0) as DIGL_OFFR_TRN_CNT_QT, coalesce(b.SUM_POS_TOT_ITM_QT,b.SUM_POS_TOT_ITM_QT,0) as DIGL_OFFR_TRN_ITM_CNT_QT, coalesce(b.SUM_POS_TOT_NET_TRN_AM,b.SUM_POS_TOT_NET_TRN_AM,0) as DIGL_OFFR_TRN_NET_SLS_AM, coalesce(b.SUM_POS_TOT_NET_TRN_AM,b.SUM_POS_TOT_NET_TRN_AM,0) + coalesce(b.SUM_POS_TOT_TAX_AM,b.SUM_POS_TOT_TAX_AM,0) as DIGL_OFFR_TRN_GRSS_SLS_AM, coalesce(a.CNT_POS_ORD_KEY_ID,a.CNT_POS_ORD_KEY_ID,0) as NON_DIGL_OFFR_TRN_CNT_QT, coalesce(a.SUM_POS_TOT_ITM_QT,a.SUM_POS_TOT_ITM_QT,0) as NON_DIGL_OFFR_TRN_ITM_QT, coalesce(a.SUM_POS_TOT_NET_TRN_AM,a.SUM_POS_TOT_NET_TRN_AM,0) as NON_DIGL_OFFR_TRN_NET_SLS_AM, coalesce(a.SUM_POS_TOT_NET_TRN_AM,a.SUM_POS_TOT_NET_TRN_AM,0) + coalesce(a.SUM_POS_TOT_TAX_AM,a.SUM_POS_TOT_TAX_AM,0) as NON_DIGL_OFFR_TRN_GRSS_SLS_AM, (coalesce(b.CNT_POS_ORD_KEY_ID,b.CNT_POS_ORD_KEY_ID,0)+coalesce(a.CNT_POS_ORD_KEY_ID,a.CNT_POS_ORD_KEY_ID,0)) as TOT_TRN_CNT_QT, (coalesce(b.SUM_POS_TOT_ITM_QT,b.SUM_POS_TOT_ITM_QT,0)+coalesce(a.SUM_POS_TOT_ITM_QT,a.SUM_POS_TOT_ITM_QT,0)) as TOT_TRN_ITM_CNT_QT, (coalesce(b.SUM_POS_TOT_NET_TRN_AM,b.SUM_POS_TOT_NET_TRN_AM,0)+coalesce(a.SUM_POS_TOT_NET_TRN_AM,a.SUM_POS_TOT_NET_TRN_AM,0)) as TOT_TRN_NET_SLS_AM, (coalesce(b.SUM_POS_TOT_NET_TRN_AM,b.SUM_POS_TOT_NET_TRN_AM,0)+coalesce(a.SUM_POS_TOT_NET_TRN_AM,a.SUM_POS_TOT_NET_TRN_AM,0) +coalesce(b.SUM_POS_TOT_TAX_AM,b.SUM_POS_TOT_TAX_AM,0) + coalesce(a.SUM_POS_TOT_TAX_AM,a.SUM_POS_TOT_TAX_AM,0)) as TOT_TRN_GRSS_SLS_AM, coalesce(b.SUM_TOT_ORD_TM_SC_QT,b.SUM_TOT_ORD_TM_SC_QT,0) as DIGL_OFFR_TOT_ORD_SC_QT, coalesce(a.SUM_TOT_ORD_TM_SC_QT,a.SUM_TOT_ORD_TM_SC_QT,0) as NON_DIGL_OFFR_TOT_ORD_SC_QT, coalesce(b.SUM_TOT_ORD_TM_SC_QT,b.SUM_TOT_ORD_TM_SC_QT,0)+coalesce(a.SUM_TOT_ORD_TM_SC_QT,a.SUM_TOT_ORD_TM_SC_QT,0) as TOT_TOT_ORD_TM_SC_QT from (select hub0.TERR_CD, hub0.POS_BUSN_DT, hub0.MCD_GBAL_LCAT_ID_NU, hub0.POS_AREA_TYP_SHRT_DS, hub0.POS_PRD_DLVR_METH_CD, hub0.DYPT_ID_NU, hub0.LGCY_LCL_RFR_DEF_CD, 0 as ORD_DIGL_OFFR_APPD_FL, count(hub0.POS_ORD_KEY_ID) as CNT_POS_ORD_KEY_ID, sum(hub0.POS_TOT_ITM_QT) as SUM_POS_TOT_ITM_QT, sum(hub0.POS_TOT_NET_TRN_AM) as SUM_POS_TOT_NET_TRN_AM, sum(coalesce(hub0.TOT_ORD_TM_SC_QT,hub0.TOT_ORD_TM_SC_QT,0)) as SUM_TOT_ORD_TM_SC_QT, sum(hub0.POS_TOT_TAX_AM) as SUM_POS_TOT_TAX_AM from daastest.tld_datahub hub0 join daastest.offers_include_list offr on hub0.terr_cd=offr.terr_cd and cast(hub0.LGCY_LCL_RFR_DEF_CD as int)=cast(offr.pos_rest_id as int) where hub0.terr_cd in (840,124) and hub0.pos_busn_dt >'${hivevar:MYDATE}' and ORD_DIGL_OFFR_APPD_FL =0 and POS_EVNT_TYP_CD='TRX_Sale' and hub0.POS_ITM_LINE_SEQ_NU=1 group by hub0.TERR_CD, hub0.POS_BUSN_DT, hub0.MCD_GBAL_LCAT_ID_NU, hub0.POS_AREA_TYP_SHRT_DS, hub0.POS_PRD_DLVR_METH_CD, hub0.DYPT_ID_NU, hub0.LGCY_LCL_RFR_DEF_CD, hub0.ORD_DIGL_OFFR_APPD_FL) a FULL OUTER JOIN (select  hub1.TERR_CD, hub1.POS_BUSN_DT, hub1.MCD_GBAL_LCAT_ID_NU, hub1.POS_AREA_TYP_SHRT_DS, hub1.POS_PRD_DLVR_METH_CD, hub1.DYPT_ID_NU, hub1.LGCY_LCL_RFR_DEF_CD, hub1.ORD_DIGL_OFFR_APPD_FL, count(hub1.POS_ORD_KEY_ID) as CNT_POS_ORD_KEY_ID, sum(hub1.POS_TOT_ITM_QT) as SUM_POS_TOT_ITM_QT, sum(hub1.POS_TOT_NET_TRN_AM) as SUM_POS_TOT_NET_TRN_AM, sum(coalesce(hub1.TOT_ORD_TM_SC_QT,hub1.TOT_ORD_TM_SC_QT,0)) as SUM_TOT_ORD_TM_SC_QT, sum(hub1.POS_TOT_TAX_AM) as SUM_POS_TOT_TAX_AM from tld_datahub hub1 join offers_include_list offr on hub1.terr_cd=offr.terr_cd and cast(hub1.LGCY_LCL_RFR_DEF_CD as int)=cast(offr.pos_rest_id as int) where hub1.terr_cd in (840,124) and hub1.pos_busn_dt >'${hivevar:MYDATE}' and ORD_DIGL_OFFR_APPD_FL=1 and POS_EVNT_TYP_CD='TRX_Sale' and  hub1.POS_ITM_LINE_SEQ_NU=1 group by  hub1.TERR_CD, hub1.POS_BUSN_DT, hub1.MCD_GBAL_LCAT_ID_NU, hub1.POS_AREA_TYP_SHRT_DS, hub1.POS_PRD_DLVR_METH_CD, hub1.DYPT_ID_NU, hub1.LGCY_LCL_RFR_DEF_CD, hub1.ORD_DIGL_OFFR_APPD_FL) b on a.TERR_CD=b.TERR_CD and a.POS_BUSN_DT=b.POS_BUSN_DT and a.MCD_GBAL_LCAT_ID_NU=b.MCD_GBAL_LCAT_ID_NU and a.POS_AREA_TYP_SHRT_DS=b.POS_AREA_TYP_SHRT_DS and a.POS_PRD_DLVR_METH_CD=b.POS_PRD_DLVR_METH_CD and a.DYPT_ID_NU=b.DYPT_ID_NU and a.LGCY_LCL_RFR_DEF_CD=b.LGCY_LCL_RFR_DEF_CD ) agg left outer join  daastest.dypt dypt on agg.dypt_id_nu = dypt.dypt_id_nu left outer join daastest.cal_dt cldt on cldt.cal_dt = agg.pos_busn_dt
DLY_TM_SEG_POS_TRN_OFFR_NP_POPULATE=insert overwrite table daastest.DLY_TM_SEG_POS_TRN_OFFR_NP select agg.TERR_CD, agg.POS_BUSN_DT, agg.MCD_GBAL_LCAT_ID_NU, agg.HR_ID_NU, coalesce(agg.CUST_OFFR_DIGL_OFFR_ID,agg.CUST_OFFR_DIGL_OFFR_ID,0), agg.POS_PRD_DLVR_METH_CD, agg.POS_AREA_TYP_SHRT_DS, agg.DYPT_ID_NU, dypt.DYPT_DS, cldt.DY_OF_CAL_WK_DS, agg.LGCY_LCL_RFR_DEF_CD, coalesce(agg.DIGL_OFFR_TRN_CNT_QT,agg.DIGL_OFFR_TRN_CNT_QT,0), coalesce(agg.DIGL_OFFR_TRN_ITM_CNT_QT,agg.DIGL_OFFR_TRN_ITM_CNT_QT,0), coalesce(agg.DIGL_OFFR_TRN_NET_SLS_AM,agg.DIGL_OFFR_TRN_NET_SLS_AM,0), coalesce(agg.DIGL_OFFR_TRN_GRSS_SLS_AM,agg.DIGL_OFFR_TRN_GRSS_SLS_AM,0), coalesce(agg.DIGL_OFFR_TOT_ORD_SC_QT,agg.DIGL_OFFR_TOT_ORD_SC_QT,0), agg.TERR_CD as CURN_ISO_NU from( select hub.TERR_CD, hub.POS_BUSN_DT, hub.MCD_GBAL_LCAT_ID_NU, hub.POS_AREA_TYP_SHRT_DS, hub.POS_PRD_DLVR_METH_CD, hub.CUST_OFFR_DIGL_OFFR_ID, hub.DYPT_ID_NU, hub.LGCY_LCL_RFR_DEF_CD, substring(hub.POS_TRN_STRT_TS,12,2) as HR_ID_NU, COUNT(hub.POS_ORD_KEY_ID) as DIGL_OFFR_TRN_CNT_QT, SUM(hub.POS_TOT_ITM_QT) as DIGL_OFFR_TRN_ITM_CNT_QT, SUM(hub.POS_TOT_NET_TRN_AM) as DIGL_OFFR_TRN_NET_SLS_AM, SUM(hub.POS_TOT_NET_TRN_AM+hub.POS_TOT_TAX_AM) as DIGL_OFFR_TRN_GRSS_SLS_AM, SUM(coalesce(hub.TOT_ORD_TM_SC_QT,hub.TOT_ORD_TM_SC_QT,0)) as DIGL_OFFR_TOT_ORD_SC_QT from daastest.tld_datahub hub join daastest.offers_include_list offr on hub.terr_cd=offr.terr_cd and cast(hub.LGCY_LCL_RFR_DEF_CD as int)=cast(offr.pos_rest_id as int) where hub.TERR_CD in (840,124) and hub.POS_BUSN_DT >"${hivevar:MYDATE}" and hub.ORD_DIGL_OFFR_APPD_FL=1 and hub.POS_EVNT_TYP_CD='TRX_Sale' and hub.POS_ITM_LINE_SEQ_NU=1 GROUP BY hub.TERR_CD, hub.POS_BUSN_DT, hub.MCD_GBAL_LCAT_ID_NU, hub.POS_AREA_TYP_SHRT_DS, hub.POS_PRD_DLVR_METH_CD, hub.CUST_OFFR_DIGL_OFFR_ID, hub.DYPT_ID_NU, hub.LGCY_LCL_RFR_DEF_CD, substring(hub.POS_TRN_STRT_TS,12,2)) agg left outer join daastest.dypt dypt on agg.dypt_id_nu = dypt.dypt_id_nu left outer join daastest.cal_dt cldt on cldt.cal_dt = agg.pos_busn_dt
POS_TRN_OFFR_NP_POPULATE=insert overwrite table daastest.POS_TRN_OFFR_NP select hub.TERR_CD, hub.POS_ORD_KEY_ID, hub.MCD_GBAL_LCAT_ID_NU, hub.POS_BUSN_DT, hub.DYPT_ID_NU, hub.LGCY_LCL_RFR_DEF_CD, hub.POS_TRN_STRT_TS, hub.POS_AREA_TYP_SHRT_DS, hub.POS_PRD_DLVR_METH_CD, cldt.DY_OF_CAL_WK_DS, dypt.DYPT_DS, cast(substring(hub.POS_TRN_STRT_TS,12,2) as int) as HR_ID_NU, coalesce(hub.POS_TOT_NET_TRN_AM,hub.POS_TOT_NET_TRN_AM,0), coalesce(hub.POS_TOT_NET_TRN_AM+hub.POS_TOT_TAX_AM,hub.POS_TOT_NET_TRN_AM+hub.POS_TOT_TAX_AM,0) as POS_TOT_GRSS_TRN_AM, coalesce(hub.POS_TOT_ITM_QT,hub.POS_TOT_ITM_QT,0), coalesce(hub.TOT_ORD_TM_SC_QT,hub.TOT_ORD_TM_SC_QT,0), coalesce(hub.CUST_OFFR_DIGL_OFFR_ID,hub.CUST_OFFR_DIGL_OFFR_ID,0), coalesce(hub.CUST_ID,hub.CUST_ID,hub.CUST_ID,hub.CUST_ID,0), coalesce(hub.CUST_OFFR_ID,hub.CUST_OFFR_ID,0), hub.TERR_CD  FROM daastest.tld_datahub hub join daastest.offers_include_list offr on hub.terr_cd=offr.terr_cd and cast(hub.LGCY_LCL_RFR_DEF_CD as int)=cast(offr.pos_rest_id as int) left outer join  daastest.dypt dypt on hub.dypt_id_nu = dypt.dypt_id_nu left outer join daastest.cal_dt cldt on cldt.cal_dt = hub.pos_busn_dt WHERE hub.TERR_CD in (840,124) and hub.POS_BUSN_DT >= "${hivevar:MYDATE}" and hub.POS_ITM_LINE_SEQ_NU=1 and hub.POS_EVNT_TYP_CD='TRX_Sale' and hub.ORD_DIGL_OFFR_APPD_FL=1
REFRESH_DAYS=14
